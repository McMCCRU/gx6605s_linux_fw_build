Burning Метод записи SPI-FLASH 4MB с использованием последовательного и USB портов на "без кварцевых" приставкaх с gx3235s.

Введение:

* На "без кварцевых" приставках процессор gx3235s берет внешнюю тактовую частоту на 24МГц от тюнера.
* Встроенный микробутлоадер в процессор устанавливает скорость последовательного порта равную 115200 бод,
  однако при внешней тактовой частоте процессора на 24МГц эта скорость будет равна 115200 * 24 / 27 = 102400 бод.
* Требуются RS232 USB-TTL адаптеры на 3.3В, которые умеют работать на не стандартных скоростях последовательного
  порта. Точно подходят адаптеры на базе FTDI FT232RL(проверено) и по слухам Silicon Labs CP2102.
* Так же потребуется USB флэш отформатированная под FAT32.
* Программа boot.elf, запускается на компьютере с Ubuntu Linux.
* gx6605s-generic-sflash.boot перепрошивает вспомогательную программу прошивки в память устройства.

Выполнить команду:
* ./boot.elf --help Получить помощь.

Установка не стандартной скорости последовательного порта в Linux:

* Вставить RS232 USB-TTL адаптер на 3.3В в компьютер и запустить утилиту setserial:
$ setserial -a /dev/ttyUSB0
/dev/ttyUSB0, Line 0, UART: unknown, Port: 0x0000, IRQ: 0
        Baud_base: 24000000, close_delay: 0, divisor: 0
        closing_wait: infinite
        Flags: spd_normal
видно, что скорость порта по умолчаню установлена в 24000000 бод, что бы установить скорость 102400 бод, необходимо
использовать делитель, расcчитаем его как 24000000 / 102400 = 234,375, округляем до 234 или 233, в зависимости от того,
как сработает gxdownloader, в моем случае стабильно сработало на 233. Теперь установим этот делитель в параметры порта:
$ setserial /dev/ttyUSB0 divisor 233 spd_cust
и проверяем:
$ setserial -a /dev/ttyUSB0
/dev/ttyUSB0, Line 0, UART: unknown, Port: 0x0000, IRQ: 0
        Baud_base: 24000000, close_delay: 0, divisor: 233
        closing_wait: infinite
        Flags: spd_cust
Внешне получилось правильно, что бы использовать эту скорость, нам необходимо указать в программе скорость порта 38400!
Стандартная скорость 38400 виртуально подменяется на не стандартную, это значение фиксированное для таких целей...

Записать прошивку:
* ./boot.elf -b gx6605s-generic-sflash.boot -d /dev/ttyUSB0 -r 38400
   где /dev/ttyUSB0 - последовательный порт USB адаптера на компьютере, подключенный к приставке.
* Как только загрузится загрузчик в память, он сразу выполнится и вы увидите информацию от загрузчика.
* Необходимо подключится терминальной программой к нашему устройству, для этого используем minicom или picocom:
$ picocom -b 115200 /dev/ttyUSB0 (115200, не 38400!!!)
нажимаем Enter и получаем приглашение:
boot>
* Можно набрать help или ? и посмотреть список команд загрузчика.
* Необходимо скопировать 4Мб образ прошивки, например fullflash_linux_4m.bin, на USB флеш в основной корень.
* Вставить USB флеш в устройство и выполнить команду обновления прошивки:
boot> usbdown 0 fullflash_linux_4m.bin

Если флэш исправная и отформатированная в FAT32, то процесс обновления пройдет быстро, после обновления нужно вытащить
USB флэш из устройства и набрать команду reboot, или выключить и включить питание...
